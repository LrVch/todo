function findElem(t,e){var n=0;return t.forEach(function(t,o){t.id+""===e&&(n=o)}),n}function addBr(t){var e=JSON.stringify(t).replace(/\\n/gi,"<br>");return JSON.parse(e)}function addNewLine(t){t=(""+t).replace(/<br>/gi,"\n");var e=JSON.stringify(t);return JSON.parse(e)}function genId(){return Math.random().toString(32).slice(2)}function placeCaretAtEnd(t){if(t.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(e)}else if("undefined"!=typeof document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(t),o.collapse(!1),o.select()}}angular.module("templates",[]),angular.module("templates").run(["$templateCache",function(t){t.put("templates/add-note.template.html",'<div class="add-note clearfix" ">\r\n\t{{ welcomeText }}\r\n\t<div\r\n\t\tng-show="!isEdit"\r\n\t\tng-click="activate()"\r\n\t\tclass="add-note__mask"></div>\r\n\r\n\t<!-- <div class="add-note__btns"> -->\r\n\t\t<!-- <a\r\n\t\t\thidden\r\n\t\t\thref="#"\r\n\t\t\tclass="glyphicon glyphicon-star-empty"\r\n\t\t\tng-click="stickNote($event)"></a> -->\r\n\t\t<button\r\n\t\t\tclass="add-note__togle-view"\r\n\t\t\ttype="button"\r\n\t\t\tng-click="changeView(currentView)">{{ currentView ? \'L\' : \'T\' }}</button>\r\n\t<!-- </div> -->\r\n\r\n\t<div\r\n\t\tclass="add-note__content"\r\n\t\tng-show="isEdit">\r\n\t\t\r\n\t\t<!-- title -->\r\n\t\t<div\r\n\t\t\tclass="add-note__title"\r\n\t\t\tid="addTitle"\r\n\t\t\tng-bind-html="title"\r\n\t\t\tng-keypress="gotoText($event)"\r\n\t\t\tng-blur="setTitle()"\r\n\t\t\tng-click="manageTitle()"\r\n\t\t\t></div>\r\n\r\n\t\t<!-- text -->\r\n\t\t<div\r\n\t\t\tng-show="currentView"\r\n\t\t\tclass="add-note__text"\r\n\t\t\tid="addNoteText"\r\n\t\t\tng-bind-html="text"\r\n\t\t\tng-blur="setPlainText()"\r\n\t\t\ttabindex="0"></div>\r\n\r\n\t\t<!-- list -->\r\n\t\t<div\r\n\t\t\tng-show="!currentView"\r\n\t\t\tclass="add-note__list-view">\r\n\t\t\t<ul class="add-note__list">\r\n\t\t\t\t<li\r\n\t\t\t\t\tclass="list-group-item add-note__list-item"\r\n\t\t\t\t\tng-repeat="item in filtered = (text | isCompleted: false)  track by $index">\r\n\t\t\t\t\t<div class="add-note__list-item-cell">\r\n\t\t\t\t\t\t<input type="checkbox" ng-model="item.isCompleted" ng-change="changeCompleted(item.id)">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="add-note__list-item-cell">\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass="add-note__list-item-area"\r\n\t\t\t\t\t\t\tid="{{item.id}}"\r\n\t\t\t\t\t\t\tng-blur="saveItem(item.id)"\r\n\t\t\t\t\t\t\tng-keypress="addItemAfterItem($event, item.id)"\r\n\t\t\t\t\t\t\tng-click="editItem($event, item.id)"\r\n\t\t\t\t\t\t\tng-bind-html="item.text"\r\n\t\t\t\t\t\t></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="add-note__list-item-cell" class="clearfix">\r\n\t\t\t\t\t\t<a href="#" class="glyphicon glyphicon-remove  pull-right add-note__list-item-remove" aria-hidden="true" ng-click="deleteItemFromList($event, item.id)"></a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class="list-group-item add-note__list-item">\r\n\t\t\t\t\t<div class="add-note__list-item-cell">\r\n\t\t\t\t\t\t<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="add-note__list-item-cell">\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tid="newItem-003"\r\n\t\t\t\t\t\t\tclass="add-note__list-item-area add-note__add-new-item"\r\n\t\t\t\t\t\t\tng-click="editItem($event, \'newItem-003\')"\r\n\t\t\t\t\t\t\tng-keypress="addNewItem($event, \'newItem-003\')"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="add-note__list-item-cell" class="clearfix">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t\t<hr ng-show="isCompletedInNote" style="border-top-color: #000; margin: 0">\r\n\t\t\t<ul class="add-note__list completed" >\r\n\t\t\t\t<li\r\n\t\t\t\t\tclass="list-group-item add-note__list-item"\r\n\t\t\t\t\tng-repeat="item in filtered = (text | isCompleted: true)  track by $index">\r\n\t\t\t\t\t<div class="add-note__list-item-cell">\r\n\t\t\t\t\t\t<a href="#" class="glyphicon glyphicon-arrow-up add-note__list-item-up" aria-hidden="true" ng-click="fromCompleted($event, item.id)"></a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="add-note__list-item-cell">\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass="add-note__list-item-area add-note__list-item-area--checked"\r\n\t\t\t\t\t\t\tid="{{item.id}}"\r\n\t\t\t\t\t\t\tng-blur="saveItem(item.id)"\r\n\t\t\t\t\t\t\tng-keypress="addItemAfterItem($event, item.id)"\r\n\t\t\t\t\t\t\tng-click="editItem($event, item.id)"\r\n\t\t\t\t\t\t>{{ item.text }}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="add-note__list-item-cell">\r\n\t\t\t\t\t\t<a href="#" class="glyphicon glyphicon-remove  pull-right add-note__list-item-remove" aria-hidden="true" ng-click="deleteItemFromList($event, item.id)"></a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\r\n\t\t\r\n\t\t\r\n\t\t<div class="add-note__footer clearfix">\r\n\t\t\t<button\r\n\t\t\t\tclass="add-note__done pull-right"\r\n\t\t\t\tng-show="isEdit"\r\n\t\t\t\ttype="button"\r\n\t\t\t\tng-click="addNote()">Done</button>\r\n\r\n\t\t\t<span class="pull-right">&nbsp;</span>\t\r\n\t\t\t<button\r\n\t\t\t\tclass="add-note__close pull-right"\r\n\t\t\t\tng-show="isEdit"\r\n\t\t\t\ttype="button"\r\n\t\t\t\tng-click="close()">Close</button>\r\n\t\t</div>\r\n\t</div>\t\r\n</div>\r\n'),t.put("templates/categories.template.html",'<div class="header">\r\n\t<div class="container">\r\n\t\t<a ui-sref=".recent">\r\n\t\t\t<img src="http://static.tumblr.com/dfca590769e2c7630fffcd4f073a851e/vmdywfv/AIgmosa4l/tumblr_static_notes_logo_square.jpg"\r\n\t\t\twidth="80" height="80">\r\n\t\t</a>\r\n\t\t<div class="row">\r\n\t\t\t<div class="col-sm-6">\r\n\t\t\t\t<form>\r\n\t\t\t\t\t<div class="input-group">\r\n\t\t\t\t\t\t<span class="input-group-btn">\r\n\t\t\t\t\t\t\t<button class="btn btn-default" type="button" ng-click="addCatetory()">Add Category</button>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t<input type="text" class="form-control" placeholder="category name" ng-model="categoryName">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</form>\r\n\t\t\t</div>\r\n\t\t\t<div class="col-sm-6">\r\n\t\t\t\t<div class="dropdown">\r\n\t\t\t\t\t<button ng-disabled="todos.categories.length ? false : true" class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n\t\t\t\t\tCategories\r\n\t\t\t\t\t<span class="caret"></span>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n\t\t\t\t\t\t<li ng-repeat="category in todos.categories">\r\n\t\t\t\t\t\t\t<a ui-sref=".category({categoryId: category })">{{ category }}</a>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<!-- <a ui-sref=".all-categories">View all categories</a> -->\r\n\t</div>\r\n</div>\r\n\r\n<!-- disableDropDown -->'),t.put("templates/init.template.html",'<categories></categories>\r\n<sticked notes="todos.fetchedNotes"></sticked>\r\n<div ui-view></div>'),t.put("templates/list-of-tasks.template.html",'<ul\r\n\tclass="list-group list-of-tasks"\r\n\tdnd-list="unCompleted"\r\n\tdnd-allowed-types="note.allowedTypes"\r\n\t>\r\n\t<!-- {{note.allowedTypes}} -->\r\n\t<li\r\n\t\tclass="list-group-item list-of-tasks__item"\r\n\t\tng-repeat="item in unCompleted"\r\n\t\tdnd-type="item.type"\r\n\t\tdnd-draggable="item"\r\n\t\tdnd-moved="unCompleted.splice($index, 1); writeListOrder(unCompleted);"\r\n\t\tdnd-effect-allowed="move"\r\n\t\tdnd-dragstart="logEvent(event, \'Started to drag an listItem\')">\r\n\t\t<!-- {{item.type}} -->\r\n\t\t<dnd-nodrag>\r\n\t\t\t<div dnd-handle class="handle">:::</div>\r\n\t\t\t<div class="list-of-tasks__item-cell">\r\n\t\t\t\t<input type="checkbox" ng-model="item.isCompleted" ng-change="change(item.id)">\r\n\t\t\t</div>\r\n\t\t\t<div class="list-of-tasks__item-cell">\r\n\t\t\t\t<div class="list-of-tasks__item-text" data-id="{{item.id}}" ng-click="edit(item.id)">{{ item.text}}</div>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tclass="list-of-tasks__item-area"\r\n\t\t\t\t\tdata-id="{{item.id}}"\r\n\t\t\t\t\thidden\r\n\t\t\t\t\tng-blur="saveText(item.id)"\r\n\t\t\t\t\tng-keypress="addNoteAfterNote($event, item.id)"\r\n\t\t\t\t></textarea>\r\n\t\t\t</div>\r\n\t\t\t<div class="list-of-tasks__item-cell" class="clearfix">\r\n\t\t\t\t<a href="#" class="list-of-tasks__icon  list-of-tasks__icon-remove  glyphicon glyphicon-remove  pull-right" aria-hidden="true" ng-click="delete($event, item.id)"></a>\r\n\t\t\t</div>\t\r\n\t\t</dnd-nodrag>\r\n\t</li>\r\n</ul>\r\n<div>\r\n\t<div class="list-group-item list-of-tasks__item">\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t</div>\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t\t<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>\r\n\t\t</div>\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t\t<div class="list-of-tasks__item-text" id="newItem-001" ng-click="editNew()">\r\n\t\t\t\tдобавить\r\n\t\t\t</div>\r\n\t\t\t<textarea\r\n\t\t\t\tclass="list-of-tasks__item-area"\r\n\t\t\t\tid="newItem-001"\r\n\t\t\t\thidden\r\n\t\t\t\tng-blur="addNew($event)"\r\n\t\t\t\tng-keypress="addNewByKeyPress($event)"></textarea>\r\n\t\t</div>\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n<hr style="border-top-color: #000">\r\n<ul class="list-group completed" >\r\n\t<li class="list-group-item list-of-tasks__item" ng-repeat="item in completed">\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t</div>\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t\t<a href="#" class="list-of-tasks__icon  glyphicon glyphicon-arrow-up  pull-right" aria-hidden="true" ng-click="fromCompleted($event, item.id)"></a>\r\n\t\t</div>\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t\t<div class="list-of-tasks__item-text list-of-tasks__item-text--checked" data-id="{{item.id}}" ng-click="edit(item.id)">{{ item.text}}</div>\r\n\t\t\t<textarea class="list-of-tasks__item-area" data-id="{{item.id}}" hidden ng-blur="saveText(item.id)"></textarea>\r\n\t\t</div>\r\n\t\t<div class="list-of-tasks__item-cell">\r\n\t\t\t<a href="#" class="list-of-tasks__icon list-of-tasks__icon-remove  glyphicon glyphicon-remove  pull-right" aria-hidden="true" ng-click="delete($event, item.id)"></a>\r\n\t\t\t\r\n\t\t</div>\r\n\t</li>\r\n</ul>'),t.put("templates/one-note.template.html",'<div class="panel panel-default one-note">\r\n\t<div class="panel-heading one-note__header">\r\n\t\t<div class="clearfix">\r\n\t\t\t<a href="#" class="one-note__icon  one-note__header-icon  glyphicon glyphicon-remove pull-right" aria-hidden="true" ng-click="deleteNote($event, note.id)"></a>\r\n\r\n\t\t\t<a href="#" ng-show="note.sticked" class="one-note__icon  one-note__header-icon  glyphicon glyphicon-heart pull-right" aria-hidden="true" ng-click="unstickNote($event, note.id)">&nbsp;</a>\r\n\r\n\t\t\t<a href="#" ng-show="!note.sticked" class="one-note__icon  one-note__header-icon  glyphicon glyphicon-heart-empty pull-right" aria-hidden="true" ng-click="stickNote($event, note.id)">&nbsp;</a>\r\n\r\n\t\t\t<small class="one-note__date">last edited {{ note.time | date }} &nbsp;</small>\r\n\t\t</div>\r\n\t\t<div class="one-note__title">\r\n\t\t\t<textarea\r\n\t\t\t\tid="{{note.id}}"\r\n\t\t\t\tclass="one-note__title-area"\r\n\t\t\t\thidden\r\n\t\t\t\tng-blur="onChangeTitle(note.id)"\r\n\t\t\t\tng-keypress="saveOnEnter($event, note.id)"\r\n\t\t\t\t>\r\n\t\t\t</textarea>\r\n\t\t\t<div id="{{note.id}}" class="one-note__title-text" ng-click="editTitle(note.id)">{{ note.title }}</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="panel-body  one-note__body">\r\n\t\t<div class="content">\r\n\t\t\t<plain-text note="note" callback-fn="saveNoteInfo()" ng-show="note.plainText"></plain-text>\r\n\t\t\t<list-of-tasks note="note" callback-fn="saveNoteInfo()" ng-show="!note.plainText"></list-of-tasks>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="panel-footer  one-note__footer">\r\n\t\t<button\r\n\t\t \tuib-popover-template="dynamicPopover.templateUrl"\r\n\t\t \ttype="button"\r\n\t\t \tclass="btn btn-default one-note__popover-btn"\r\n\t\t \tpopover-placement="{{dynamicPopover.placement}}"\r\n\t\t \tpopover-animation="true"\r\n\t\t\tpopover-trigger="\'outsideClick\'"\r\n\t\t\tpopover-is-open="dynamicPopover.isOpen"\r\n\t\t>\r\n\t\t\t|||\r\n\t\t</button>\r\n\t</div>\r\n</div>'),t.put("templates/oneCategory.template.html",'<div class="main one-category">\r\n\t<div class="container">\r\n\t\t<h2 class="one-category__title" ng-click="oneCategory.removeCategory(oneCategory.activeCategory)" ng-bind="oneCategory.activeCategory"></h2>\r\n\t\t<add-note\r\n\t\t\tng-show="oneCategory.showAddField"\r\n\t\t\tnotes="oneCategory.fetchNotes",\r\n\t\t\tsection="{{oneCategory.activeCategory}}"\r\n\t\t\tsave-fn="oneCategory.save()">\r\n\t\t</add-note>\r\n\t\t<br>\r\n\t\t<div\r\n\t\t\tclass="row one-category__list"\r\n\t\t\tdnd-list="oneCategory.notes"\r\n\t\t\tdnd-allowed-types="oneCategory.allowedTypes"\r\n\t\t>\r\n\t\t\t<div \r\n\t\t\t\tng-repeat="note in oneCategory.notes"\r\n\t\t\t\tclass="col-xs-12 col-sm-4 col-md-3 one-category__note"\r\n\t\t\t\tdnd-type="note.type"\r\n\t\t\t\tdnd-draggable="note"\r\n\t\t\t\tdnd-moved="oneCategory.notes.splice($index, 1); oneCategory.writeNotesOrder(oneCategory.notes);"\r\n\t\t\t\tdnd-effect-allowed="move"\r\n\t\t\t\tdnd-dragstart="oneCategory.logEvent(event, \'Started to drag an item\')">\r\n\t\t\t\t<one-note\r\n\t\t\t\t\tactive-section="{{ oneCategory.activeCategory }}"\r\n\t\t\t\t\tnote="note"\r\n\t\t\t\t\tcallback-fn="oneCategory.save()"\r\n\t\t\t\t\tdelete="oneCategory.deleteCertainNote(id)"\r\n\t\t\t\t\tstick-fn="oneCategory.stickFn(id)"\r\n\t\t\t\t\tunstick-fn="oneCategory.unstickNote(id)"\r\n\t\t\t\t>\r\n\t\t\t\t</one-note>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("templates/plain-text.template.html",'<div class=plain-text>\r\n\t<div\r\n\t\tclass="plain-text__text"\r\n\t\tng-click=\'edit(note.id)\'\r\n\t\tid="{{note.id}}"\r\n\t\tng-bind-html="note.notes"\r\n\t>\r\n\t</div>\r\n\t<textarea\r\n\t\tclass="plain-text__area"\r\n\t\thidden\r\n\t\tng-blur="onBlurtext($event, note.id)"\r\n\t\tid="{{note.id}}">\r\n\t</textarea>\r\n</div>'),t.put("templates/popoverTemplate.html",'<div class="note-popover" >\r\n\t<ul class="note-popover__list">\r\n\t\t<li class="note-popover__list-item">\r\n\t\t\t<a\r\n\t\t\t\thref="#"\r\n\t\t\t\tclass="note-popover__list-link"\r\n\t\t\t\tng-click="changeView($event, note.plainText)">\r\n\t\t\t\t{{ note.plainText ? "list" : "text" }}\r\n\t\t\t</a>\r\n\t\t</li>\r\n\t\t<li class="note-popover__list-item">\r\n\t\t\t<a\r\n\t\t\t\thref="#"\r\n\t\t\t\tclass="note-popover__list-link"\r\n\t\t\t\tng-show="isNotesInList(note.plainText, note)"\r\n\t\t  \t\tng-click=deleteAll($event)>\r\n\t\t\t\tdelete all\r\n\t\t\t</a>\r\n\t\t</li>\r\n\t\t<li class="note-popover__list-item">\r\n\t\t\t<a\r\n\t\t\t\thref="#"\r\n\t\t\t\tclass="note-popover__list-link"\r\n\t\t\t\tng-show="iscompletedInList(note.plainText, note)"\r\n\t\t\t\tng-click="uncheckAll($event)">\r\n\t\t\t\tup all\r\n\t\t\t</a>\r\n\t\t</li>\r\n\t\t<li class="note-popover__list-item">\r\n\t\t\t<a\r\n\t\t\t\thref="#"\r\n\t\t\t\tclass="note-popover__list-link"\r\n\t\t\t\tng-show="iscompletedInList(note.plainText, note)"\r\n\t\t\t\tng-click="deleteChecked($event)">\r\n\t\t\t\tdelete marked\r\n\t\t\t</a>\r\n\t\t</li>\r\n\t</ul>\r\n</div>'),t.put("templates/recent.template.html",'<div class="container">\r\n\t<h2>Recent</h2>\r\n\t<div class="row">\r\n\t\t<div class="col-sm-12">\r\n\t\t<h4>{{ recent.today }}</h4>\r\n\t\t<div class="row">\r\n\t\t\t<div class="col-xs-12 col-sm-4 col-md-3" ng-repeat="note in filtered = (recent.todayNotes)">\r\n\t\t\t\t<div> <a ui-sref="^.category({categoryId: note.section })" class="label label-default">{{ note.section }}</a> \r\n\t\t\t\t\t<one-note\r\n\t\t\t\t\t\tactive-section="{{ note.section }}"\r\n\t\t\t\t\t\tnote="note"\r\n\t\t\t\t\t\tcallback-fn="recent.save()"\r\n\t\t\t\t\t\tdelete="recent.deleteCertainNote(id, note.section)"\r\n\t\t\t\t\t\tstick-fn="recent.stickFn(id, note.section)"\r\n\t\t\t\t\t\tunstick-fn="recent.unstickNote(id, note.section)">\r\n\t\t\t\t\t</one-note>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("templates/sticked.template.html",'<div class="container">\r\n\t<h3>{{ title }}</h3>\r\n\t<div class="row">\r\n\t\t<div class="col-xs-12 col-sm-4 col-md-3" ng-repeat="note in sticked">\r\n\t\t\t<div>\r\n\t\t\t\t<a ui-sref=".category({categoryId: note.section })" \r\n\t\t\t\t\tng-class="{\r\n\t\t\t\t\t\t\'label label-primary\' : note.section === activeCategory,\r\n\t\t\t\t\t\t\'label label-default\' : note.section !== activeCategory, }">\r\n\t\t\t\t\t{{ note.section }}\r\n\t\t\t\t</a> \r\n\t\t\t\t<one-note\r\n\t\t\t\t\tactive-section="{{ note.section }}"\r\n\t\t\t\t\tnote="note"\r\n\t\t\t\t\tcallback-fn="save()"\r\n\t\t\t\t\tdelete="deleteCertainNote(id, note.section)"\r\n\t\t\t\t\tunstick-fn="unstickNote(id, note.section)"\r\n\t\t\t\t\tstick-fn="update(id)">\r\n\t\t\t\t</one-note>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>')}]),function(){"use strict";angular.module("core",["core.filters","core.notes"])}(),function(){"use strict";function t(t){return""+t.getDate()+(t.getMonth()+1)+t.getFullYear()}angular.module("core.filters",[]).filter("isCompleted",function(){return function(t,e){if(t=t||[],t.filter)return t.filter(function(t){return e?t.isCompleted:!t.isCompleted})}}).filter("isToday",function(){return function(e){var n=t(new Date);return e=e||[],e.filter(function(e){return t(new Date(e.time))===n})}}).filter("newFirst",function(){return function(t){return t=t||[],t.sort(function(t,e){return e.time-t.time})}})}(),function(){"use strict";angular.module("core.notes",[])}(),function(){"use strict";angular.module("core.notes").factory("Notes",["$http",function(t){return console.log("notes service call"),t({method:"GET",url:"api/notes.json"})}])}(),function(){angular.module("todoList",["core","ui.router","ngSanitize","dndLists","ui.bootstrap","templates"])}(),function(){"use strict";function t(t){function e(){return l=l?l:i(),l=l||t,console.log("api call"),l}function n(t){console.log("save data to localStorage"),localStorage.setItem("todoListData",JSON.stringify(t))}function o(){console.log("save data",l),localStorage.setItem("todoListData",JSON.stringify(l))}function i(){return JSON.parse(localStorage.getItem("todoListData"))}function r(){return l}var l;return{fetchNotes:e,getNotes:r,saveDataToLocalStorage:n,save:o}}angular.module("todoList").factory("DataService",t),t.$inject=["Notes"]}(),function(){"use strict";angular.module("todoList").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,n){e.otherwise("/"),t.state("app",{abstract:!0,templateUrl:"templates/init.template.html",controller:"TodoListController as todos",resolve:{fetchNotes:["DataService",function(t){return t.fetchNotes()}]}}).state("app.recent",{url:"/",templateUrl:"templates/recent.template.html",controller:"RecentController as recent"}).state("app.category",{url:"/category/:categoryId",templateUrl:"templates/oneCategory.template.html",controller:"OneCategoryController as oneCategory"}),n.html5Mode(!1).hashPrefix("!")}])}(),function(){"use strict";function t(t,e){console.log("TodoListController");const n=e,o=this;o.fetchedNotes=n,o.categories=Object.keys(n.data.user),t.$on("REMOVE_CATEGORY",function(t,e){console.log(e),o.categories=Object.keys(n.data.user)})}angular.module("todoList").controller("TodoListController",t),t.$inject=["$scope","fetchNotes"]}(),function(){"use strict";function t(t,e,n,o,i){function r(t){return t.filter(function(t){return!t.sticked})}function l(t){return t.filter(function(t){return t.sticked})}console.log("OneCategoryController");const a=this,s=e.categoryId,c=i.data.user;return a.fetchNotes=i,a.allowedTypes=["note"],console.log(i),s in c?(a.activeCategory=s,a.notes=r(c[a.activeCategory]),a.showAddField=!0,a.save=function(){console.log("save data"),a.notes=r(c[a.activeCategory]),n.saveDataToLocalStorage(i)},a.writeNotesOrder=function(t){console.log("writeNotesOrder"),console.log(i.data.user[s]),console.log(t);const e=l(i.data.user[s]);console.log(e);const n=e.concat(t);i.data.user[s]=n,a.save()},a.logEvent=function(t,e){console.log("logEvent",e),console.log(t),console.log(t.target)},a.removeCategory=function(e){if(c[s].length){const r=confirm("Категория не пуста, все равно удалить?");if(!r)return}const l=Object.keys(i.data.user);console.log("notes before removeCategory",c),delete c[e],l.length>1?o.go("^.category",{categoryId:l[0]===s?l[1]:l[0]}):(a.activeCategory="Добавьте категорию",a.notes=[],a.showAddButton=!1,a.showAddField=!1),console.log(i),n.saveDataToLocalStorage(i),console.log("notes after removeCategory",c),t.$parent.$broadcast("REMOVE_CATEGORY","data")},a.deleteCertainNote=function(e){console.log(i.data.user),c[s].splice(findElem(c[s],e),1),console.log(i.data.user),n.saveDataToLocalStorage(i),t.$parent.$broadcast("DELETE_NOTE",{id:e,section:s}),a.notes=r(c[a.activeCategory])},a.stickFn=function(e){c[s][findElem(c[s],e)].sticked=!0,console.log("sticked in OneCategoryController"),n.saveDataToLocalStorage(i),t.$parent.$broadcast("STICK_NOTE",{id:e,section:s}),a.notes=r(c[a.activeCategory])},a.unstickNote=function(e){c[s][findElem(c[s],e)].sticked=!1,console.log("unsticked in OneCategoryController"),n.saveDataToLocalStorage(i),t.$parent.$broadcast("UNSTICK_NOTE",{id:e,section:s})},t.$on("UNSTICK_NOTE",function(t,e){console.log("unsticked event form sticked controller"),a.notes=r(i.data.user[a.activeCategory])}),void t.$parent.$broadcast("CHANGE_SECTION",{categoryId:e.categoryId})):(a.activeCategory="нет такой категории",void(a.showAddField=!1))}angular.module("todoList").controller("OneCategoryController",t),t.$inject=["$scope","$stateParams","DataService","$state","fetchNotes"]}(),function(){"use strict";function t(t,e,n,o,i){function r(t){const e=Object.keys(t),n=e.reduce(function(e,n){return e.concat(t[n])},[]);l.allNotes=n,l.todayNotes=o(n),l.today=l.todayNotes.length?"changed today":"there are no changes today"}console.log("RecentController");const l=this,a=n.data.user;r(a),l.save=function(){console.log("save data in recent"),e.saveDataToLocalStorage(n)},l.deleteCertainNote=function(o,i){n.data.user[i].splice(findElem(n.data.user[i],o),1),r(n.data.user),e.saveDataToLocalStorage(n),t.$parent.$broadcast("DELETE_NOTE",{id:o,section:i})},l.stickFn=function(o,i){a[i][findElem(a[i],o)].sticked=!0,console.log("sticked in OneCategoryController"),e.saveDataToLocalStorage(n),console.log(n.data.user),t.$parent.$broadcast("STICK_NOTE",{id:o,section:i})},l.unstickNote=function(o,i){a[i][findElem(a[i],o)].sticked=!1,console.log("unsticked in OneCategoryController"),e.saveDataToLocalStorage(n),console.log(n.data.user),t.$parent.$broadcast("UNSTICK_NOTE",{id:o,section:i})},t.$on("EDIT_TODAY",function(t,e){console.log("EDIT_TODAY",e),r(n.data.user)}),t.$parent.$broadcast("CHANGE_SECTION",{categoryId:""})}angular.module("todoList").controller("RecentController",t),t.$inject=["$scope","DataService","fetchNotes","isTodayFilter","newFirstFilter"]}(),function(){"use strict";function t(t,e,n){return{restrict:"E",scope:{notes:"="},templateUrl:"templates/sticked.template.html",controller:["$scope","$element",function(n,o){function i(t){const e=Object.keys(t),o=e.reduce(function(e,n){return e.concat(t[n])},[]);n.sticked=o.filter(function(t){return t.sticked}),n.title=n.sticked.length?"Sticked":""}console.log("stickedController");const r=n.notes.data.user;i(r),n.activeCategory=e.categoryId,n.save=function(){console.log("save data in sticed"),t.saveDataToLocalStorage(n.notes)},n.deleteCertainNote=function(e,o){n.notes.data.user[o].splice(findElem(n.notes.data.user[o],e),1),i(n.notes.data.user),t.saveDataToLocalStorage(n.notes)},n.unstickNote=function(e,o){console.log("unstick in sticked",e),console.log(r[o]),r[o][findElem(r[o],e)].sticked=!1,t.saveDataToLocalStorage(n.notes),console.log(n.notes.data.user),i(n.notes.data.user),n.$parent.$broadcast("UNSTICK_NOTE",{id:e,section:o})},n.$on("STICK_NOTE",function(t,e){i(r)}),n.$on("UNSTICK_NOTE",function(t,e){i(r)}),n.$on("DELETE_NOTE",function(t,e){i(r)}),n.$on("EDIT_TODAY",function(t,e){}),n.$on("CHANGE_SECTION",function(t,e){n.activeCategory=e.categoryId})}]}}angular.module("todoList").directive("sticked",t),t.$inject=["DataService","$stateParams","$state"]}(),function(){"use strict";function t(t,n){return{restrict:"E",templateUrl:"templates/categories.template.html",controller:e}}function e(t,e,n,o){console.log("CategoriesController"),t.addCatetory=function(){const e=t.todos.categories;if(t.categoryName){if(e.indexOf(t.categoryName)!==-1)return void alert("такая категория существует");const i=t.todos.fetchedNotes;console.log("notes before addCatetory",i);const r=i.data.user;r[t.categoryName]=[],console.log("fetchedNotes fetchedNotes",i),n.saveDataToLocalStorage(i),t.todos.categories=Object.keys(t.todos.fetchedNotes.data.user),o.go("^.category",{categoryId:t.categoryName}),t.categoryName="",console.log("notes after addCatetory",r)}}}angular.module("todoList").directive("categories",t),t.$inject=["DataService","$state"],e.$inject=["$scope","$element","DataService","$state"]}(),function(){"use strict";function t(t,e){return{restrict:"E",scope:{note:"=",callbackFn:"&callbackFn",deleteFn:"&delete",activeSection:"@",stickFn:"&stickFn",unstickFn:"&unstickFn"},templateUrl:"templates/one-note.template.html",link:function(t,n,o){function i(){t.note.time=Date.now(),t.note.section=t.activeSection,t.titleNote&&(t.note.title=t.titleNote),t.callbackFn(),t.$parent.$parent.$parent.$broadcast("EDIT_TODAY","edit today")}function r(t){var e=0;return t.reduce(function(n,o){return n+=e>=t.length-1?o.text:o.text+"<br>",e++,n},"")}function l(t){return t.some(function(t){return t.isCompleted})}function a(e){const n=e.split("<br>");if(1===n.length&&""===n[0])return[];const o=t.note.allowedTypes[0];return n.map(function(t){return{text:t,isCompleted:!1,id:"id"+genId(),type:o}})}function s(t){return t.filter(function(t){return!t.isCompleted})}function c(t){return t.map(function(t){return t.isCompleted=!1,t})}var d;t.dynamicPopover={templateUrl:"templates/popoverTemplate.html",placement:"top-left",isOpen:!1},t.isNotesInList=function(t,e){return!(t||!e.notes.length)},t.iscompletedInList=function(t,e){return!(t||!l(e.notes))},t.deleteNote=function(e,n){e.preventDefault(),t.deleteFn({id:n})},t.editTitle=function(t){const o=n[0],i=o.querySelector("div#"+t),r=o.querySelector("textarea#"+t);r.style.height=i.offsetHeight+"px",r.style.width=i.offsetWidth+"px",r.style.fontSize=getComputedStyle(i).fontSize,r.style.fontFamily=getComputedStyle(i).fontFamily,r.style.paddingTop=getComputedStyle(i).paddingTop,r.style.paddingBottom=getComputedStyle(i).paddingBottom,r.style.paddingLeft=getComputedStyle(i).paddingLeft,r.style.paddingRight=getComputedStyle(i).paddingRight,r.style.lineHeight=getComputedStyle(i).lineHeight,i.hidden=!0,r.hidden=!1,d=e(function(){r.style.height=r.scrollHeight+"px",console.log("yes")},50),r.value=i.innerHTML,r.focus()},t.onChangeTitle=function(o){const r=n[0],l=r.querySelector("div#"+o),a=r.querySelector("textarea#"+o);l.innerHTML=a.value,e.cancel(d),d=void 0,l.hidden=!1,a.hidden=!0,t.titleNote=a.value,i()},t.saveOnEnter=function(e,n){13===e.which&&t.onChangeTitle(n)},t.saveNoteInfo=i,t.deleteAll=function(e){e.preventDefault(),t.note.notes=[],i(),t.dynamicPopover.isOpen=!1},t.deleteChecked=function(e){e.preventDefault(),t.note.notes=s(t.note.notes),i(),t.dynamicPopover.isOpen=!1},t.changeView=function(e,n){if(e.preventDefault(),n=!n){if(l(t.note.notes)){const o=confirm("Удалить завершенные?");if(o){const c=s(t.note.notes);t.note.notes=r(c)}else t.note.notes=r(t.note.notes);return t.note.plainText=!0,i(),void(t.dynamicPopover.isOpen=!1)}t.note.notes=r(t.note.notes),t.note.plainText=!0,console.log("text")}else t.note.notes=a(t.note.notes),t.note.plainText=!1,console.log("list");t.dynamicPopover.isOpen=!1,i()},t.uncheckAll=function(e){e.preventDefault(),t.note.notes=c(t.note.notes),i(),t.dynamicPopover.isOpen=!1},t.stickNote=function(e,n){e.preventDefault(),console.log("stick"),t.stickFn({id:n})},t.unstickNote=function(e,n){e.preventDefault(),console.log("unstick"),t.unstickFn({id:n})}}}}angular.module("todoList").directive("oneNote",t),t.$inject=["DataService","$interval"]}(),function(){"use strict";function t(t,e,n){return{restrict:"E",scope:{note:"=",callbackFn:"&callbackFn"},templateUrl:"templates/plain-text.template.html",link:function(t,e,o){function i(){t.callbackFn()}var r;t.edit=function(t){const o=e[0],i=o.querySelector("div#"+t),l=o.querySelector("textarea#"+t);l.style.height=i.offsetHeight+"px",l.style.width=i.offsetWidth+"px",l.style.fontSize=getComputedStyle(i).fontSize,l.style.fontFamily=getComputedStyle(i).fontFamily,i.hidden=!0,l.hidden=!1,r=n(function(){l.style.height=l.scrollHeight+"px"},50),l.value=addNewLine(i.innerHTML),l.focus()},t.onBlurtext=function(o,l){const a=e[0],s=a.querySelector("div#"+l),c=a.querySelector("textarea#"+l);s.innerHTML=addBr(c.value),n.cancel(r),r=void 0,t.note.notes=addBr(c.value),s.hidden=!1,c.hidden=!0,i()}}}}angular.module("todoList").directive("plainText",t),t.$inject=["$state","DataService","$interval"]}(),function(){"use strict";function t(t,e){return{restrict:"E",scope:{note:"=",callbackFn:"&callbackFn"},templateUrl:"templates/list-of-tasks.template.html",link:function(t,e,n){function o(){t.unCompleted=Array.isArray(t.note.notes)?s(t.note.notes):[],t.completed=Array.isArray(t.note.notes)?a(t.note.notes):[]}function i(e){const n=t.note.allowedTypes[0];t.note.notes.push({text:e,isCompleted:!1,id:"id"+genId(),type:n})}function r(e,n){const o=t.note.allowedTypes[0];t.note.notes.splice(findElem(t.note.notes,e)+1,0,{text:"",isCompleted:!1,id:n,type:o})}function l(){t.callbackFn()}function a(t){return t.filter(function(t){return t.isCompleted})}function s(t){return t.filter(function(t){return!t.isCompleted})}o(),t.writeListOrder=function(e){console.log("writeListOrder"),console.log(t.note),console.log(e);const n=t.unCompleted.concat(t.completed);t.note.notes=n,console.log(t.note.notes),l(),o()},t.logEvent=function(t,e){console.log("logEvent",e),console.log(t),console.log(t.target)},t.change=function(e){console.log(e),t.note.notes[findElem(t.note.notes,e)].isCompleted=!0,console.log(findElem(t.note.notes,e)),l(),o()},t.fromCompleted=function(e,n){e.preventDefault(),t.note.notes[findElem(t.note.notes,n)].isCompleted=!1,t.completed=!1,l(),o(),console.log(findElem(t.note.notes,n))},t.delete=function(e,n){e.preventDefault(),t.note.notes.splice(findElem(t.note.notes,n),1),console.log(findElem(t.note.notes,n)),l(),o()},t.edit=function(t){const n=e[0],o=n.querySelector("div[data-id='"+t+"']"),i=n.querySelector("textarea[data-id='"+t+"']");console.log(t),console.log(n),console.log(o),console.log(i),i.style.height=o.offsetHeight+"px",i.style.width=o.offsetWidth+"px",i.style.fontSize=getComputedStyle(o).fontSize,i.style.fontFamily=getComputedStyle(o).fontFamily,o.hidden=!0,i.hidden=!1,i.value=o.innerHTML,i.focus()},t.saveText=function(n){const i=e[0],r=i.querySelector("div[data-id='"+n+"']"),a=i.querySelector("textarea[data-id='"+n+"']");r.innerHTML=a.value,t.note.notes[findElem(t.note.notes,n)].text=a.value,r.hidden=!1,a.hidden=!0,l(),o()},t.editNew=function(t){const n=e[0],o=n.querySelector("div#newItem-001"),i=n.querySelector("textarea#newItem-001");i.style.height=o.offsetHeight+"px",i.style.width=o.offsetWidth+"px",i.style.fontSize=getComputedStyle(o).fontSize,i.style.fontFamily=getComputedStyle(o).fontFamily,o.hidden=!0,i.hidden=!1,i.focus()},t.addNew=function(){const t=e[0],n=t.querySelector("div#newItem-001"),r=t.querySelector("textarea#newItem-001");n.hidden=!1,r.hidden=!0,r.value.trim()&&(console.log("blur"),i(r.value),r.value="",
l(),o())},t.addNewByKeyPress=function(t){if(13===t.which){const n=e[0],r=(n.querySelector("div#newItem-001"),n.querySelector("textarea#newItem-001"));if(!r.value.trim())return;i(r.value),r.value="",l(),o()}},t.addNoteAfterNote=function(n,o){const i=e[0],l=i.querySelector("textarea[data-id='"+o+"']");if(l.style.height=l.scrollHeight+"px",13===n.which){const a="id"+genId();t.saveText(o),r(o,a),setTimeout(function(){console.log("newNoteId",a),t.edit(a)},0)}},t.$on("EDIT_TODAY",function(t,e){o()})}}}angular.module("todoList").directive("listOfTasks",t),t.$inject=["$state","isCompletedFilter"]}(),function(){"use strict";function t(t,e,n){return{restrict:"E",scope:{notes:"=",saveFn:"&saveFn",section:"@"},templateUrl:"templates/add-note.template.html",link:function(t,e,o){function i(t,e){return{text:t,isCompleted:!1,id:e}}function r(){t.text="",t.title=f,t.currentView=!0,t.sticked=!1}function l(t){return t.indexOf("<div>")===-1?t:t.replace(/\&nbsp\;/gi,"").replace(/\amp\;/gi,"").replace(/\<\/div\>/gi,"").replace(/\<br\>/gi,"").replace(/\<div\>/gi,"<br>")}function a(t){return t.replace(/\&nbsp\;/gi,"").replace(/\amp\;/gi,"").replace(/\<\/div\>/gi,"").replace(/\<br\>/gi,"").replace(/\<div\>/gi,"<br>")}function s(e){t.notes.data.user[t.section].splice(0,0,e)}function c(t){const e=l(t),n=e.split("<br>");return 1===n.length&&""===n[0]?[]:n.map(function(t){return{text:t,isCompleted:!1,id:"id"+genId()}})}function d(t){return t.reduce(function(t,e,n){return t+=0===n?e.text:"<div>"+e.text+"</div>"},"")}function u(t){return t.some(function(t){return t.isCompleted})}function g(t){return t.filter(function(t){return!t.isCompleted})}function p(t){const e=t.slice();return e.map(function(t){return t.text=a(t.text),t})}function m(t,e){const n=t.slice();return n.map(function(t){return t.type=e,t})}var f="Enter a title",v=e[0],y=v.querySelector("#addTitle"),h=v.querySelector("#addNoteText");t.currentView=!0,t.isEdit=!1,t.text="",t.title=f,t.welcomeText="take a note",t.sticked=!1,t.isCompletedInNote=!1,t.close=function(){t.isEdit=!1,r()},t.activate=function(){t.isEdit=!0,t.currentView=!0,y.contentEditable=!0,h.contentEditable=!0,n(function(){h.focus()},0)},t.manageTitle=function(){y.contentEditable=!0,y.focus(),t.title===f&&(t.title=""),console.log(t.title)},t.gotoText=function(t){13===t.which&&(y.contentEditable=!1)},t.setTitle=function(){return y.innerHTML.replace(/\&nbsp\;/gi,"").trim().length?void(t.title=y.innerHTML):void(t.title=f)},t.setPlainText=function(){t.text=h.innerHTML},t.changeView=function(e){if(t.currentView=!e,t.isEdit=!0,y.contentEditable=!0,h.contentEditable=!0,t.currentView){if(console.log("text"),!t.text.length)return void(t.text="");if(u(t.text)){const n=confirm("Удалить завершенные?");if(n){const o=g(t.text);t.text=d(o)}else t.text=d(t.text)}t.text=d(t.text)}else{if(console.log("list"),!t.text.replace(/\&nbsp\;/gi,"").trim().length)return void(t.text=[]);t.text=c(t.text),t.isCompletedInNote=t.iscompletedInList(t.currentView,t.text)}},t.editItem=function(t,e){const n=v.querySelector("#"+e);n.contentEditable=!0,n.focus()},t.addNewItem=function(e,o){const r=v.querySelector("#"+o),l="id"+genId();t.text.push(i(String.fromCharCode(e.which),l)),n(function(){const t=v.querySelector("#"+l);t.contentEditable=!0,placeCaretAtEnd(t),r.innerHTML=""},0)},t.saveItem=function(e){const n=v.querySelector("#"+e);t.text[findElem(t.text,e)].text=n.innerHTML},t.deleteItemFromList=function(e,n){e.preventDefault(),console.log(n),t.text.splice(findElem(t.text,n),1),t.isCompletedInNote=t.iscompletedInList(t.currentView,t.text)},t.addItemAfterItem=function(e,o){if(13===e.which){e.preventDefault(),v.querySelector("#"+o).contentEditable=!1;const r="id"+genId();t.text.splice(findElem(t.text,o)+1,0,i("",r)),n(function(){const t=v.querySelector("#"+r);t.contentEditable=!0,t.focus()},0)}},t.changeCompleted=function(e){t.text[findElem(t.text,e)].isCompleted=!0,t.isCompletedInNote=t.iscompletedInList(t.currentView,t.text)},t.fromCompleted=function(e,n){e.preventDefault(),t.text[findElem(t.text,n)].isCompleted=!1,t.isCompletedInNote=t.iscompletedInList(t.currentView,t.text)},t.addNote=function(){t.isEdit=!1;var e;const n=genId()+"";t.currentView?(e=l(t.text),console.log(e)):(e=p(t.text),e=m(e,n),console.log(e)),e.length&&(s({title:t.title===f?"":t.title,id:"id"+genId(),allowedTypes:[n],notes:e,plainText:t.currentView,section:t.section,time:Date.now(),sticked:t.sticked,type:"note"}),t.saveFn(),r(),console.log("isEdit",t.isEdit))},t.stickNote=function(e){e.preventDefault(),t.sticked=!0},t.iscompletedInList=function(t,e){return!(t||!u(e))}}}}angular.module("todoList").directive("addNote",t),t.$inject=["DataService","$interval","$timeout"]}();